unit Unit1;

interface

uses
  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
  Dialogs, StdCtrls,WinSock,   ScktComp,   CheckLst;
 const 
  MAX_ADAPTER_NAME_LENGTH = 256;
  MAX_ADAPTER_DESCRIPTION_LENGTH = 128;
  MAX_ADAPTER_ADDRESS_LENGTH = 8;
type
  TIP_ADDRESS_STRING = record
    IPstring: array [0..15] of Char;
  end;
  PIP_ADDRESS_STRING = ^TIP_ADDRESS_STRING;
  TIP_MASK_STRING = TIP_ADDRESS_STRING;
  PIP_MASK_STRING = ^TIP_MASK_STRING;

  PIP_ADDR_STRING = ^TIP_ADDR_STRING;
  TIP_ADDR_STRING = record
    Next: PIP_ADDR_STRING;
    IpAddress: TIP_ADDRESS_STRING;
    IpMask: TIP_MASK_STRING;
    Context:DWORD;
  end;

  PIP_ADAPTER_INFO = ^TIP_ADAPTER_INFO;
  TIP_ADAPTER_INFO = packed record
    Next: PIP_ADAPTER_INFO;
    ComboIndex: DWORD;
    AdapterName: array [0..MAX_ADAPTER_NAME_LENGTH + 4-1] of Char;
    Description: array [0..MAX_ADAPTER_DESCRIPTION_LENGTH + 4-1] of Char;
    AddressLength: UINT;
    Address: array [0..MAX_ADAPTER_ADDRESS_LENGTH-1] of BYTE;
    Index: DWORD;
    dwType: UINT;
    DhcpEnabled: UINT;
    CurrentIpAddress: PIP_ADDR_STRING;
    IpAddressList: TIP_ADDR_STRING;
    GatewayList: TIP_ADDR_STRING;
    DhcpServer: TIP_ADDR_STRING;
    HaveWins: BOOL;
    PrimaryWinsServer: TIP_ADDR_STRING;
    SecondaryWinsServer: TIP_ADDR_STRING;
  end;
  ///////////////
  TForm1 = class(TForm)
    Button1: TButton;
    function   GetipFangshi:Boolean;
    procedure Button1Click(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  Form1: TForm1;

implementation
function   GetAdaptersInfo(pAdapterInfo: PIP_ADAPTER_INFO;
                pOutBufLen: PDWORD): DWORD; stdcall;
                external 'IPHLPAPI.DLL' name 'GetAdaptersInfo';
{$R *.dfm}
function TForm1.GetipFangshi:Boolean;

var
  pbuf:PIP_ADAPTER_INFO;
  buflen:DWORD;
  i:   integer;
begin
  buflen:= 0;
  if GetAdaptersInfo(pbuf, @bufLen) = ERROR_BUFFER_OVERFLOW then
  begin
    pbuf:= AllocMem(buflen);
    if GetAdaptersInfo(pbuf, @bufLen) = ERROR_SUCCESS then
    while pbuf <> nil do
    begin
      //showmessage( IntToStr( pbuf.DhcpEnabled ) );//1动态分配
      if  pbuf.DhcpEnabled=1 then
      Result:=False else
      Result:=True;
      pbuf   :=   pbuf.Next;
    end;
    FreeMem(pbuf);
  end;
end;
  function test:string;
  begin
Result:='
[zjnbjsq]3CBB208C8231A122BCFE6C0A55C31E9E6E2FBB0BA34398B33AE82E491058879F4CD5270C1DBEE111D67F9BA78F815CB5258BDB15AAC3C01E8350CEBDAEC94C74E80D1F9D233AE4140638F4D41B764C75D6A2D7ACB2FFF167CD1FF6DB4CCB76DDBBC98DBAA1BBA3F3252FC7E310D8D153EC80F07B9F01A61A495F6616075C54D185B0CBD8F06321F6D409EE99A36BB9FD93E44BCD33BA8B29D1767F0AE585C8FA48CDC3560C28BF4F767CC754E035220ADF9DC40A1F65B03EEDA7EEAF9D928F6202D4BB3BE2E04419F716382F1EAC23B8036192852CC9957F8140A0D9F4FE669F001289587BDBB93E1FB66D7D01DAF7AED9AD36CE5A5E7A9430652F048654465346D51DE7E2E98EE0EAC15FA7B84874DAE374B422F0BDBE2E7B8250C025AD98BE4FD8FF54C479C3CD6DBA4CB5CCB41E11180058690DAF5C47BD727FBBF6AE48E814F0E8A7D3BF97B8C301CA2F3CD027BFA4E687DE07EC13B70AFC71A3323441A890A092FE7F82CC09EC95F7E1ABD1CA6031AF132313DE2246B321EFAF8CB60FAD5AF0EADCABDC4B6365CEAD6ECFC08474B151E9C89E7EB401FCDDC10781D463F8FB9CB58F5EDF3175F98400C8903400F7838DD4FA5094C77392EB767C6625F5D284247B86E81C1F6FCAB75740A056149A3850A2491EE1AC7F68581520C759578049890C919D8F404E4E0B42B0D9F960C30CA5FCC74639B69F39AEFAB6FC7A4E1D0185F5992B93FB268EB6BF1AA80D13E593905B01B2F962C816B4E3B8E1441063921201563B5B90D22BA874779872AF3A4DC12E27E96EC442D074B33F02C2E1EEE25E6D[/zjnbjsq]
';
   end;  
procedure TForm1.Button1Click(Sender: TObject);
begin
if GetipFangshi=True then
ShowMessage('你的电脑是固定IP上网')
else
ShowMessage('你的电脑是动态IP上网');
end;

end.
 